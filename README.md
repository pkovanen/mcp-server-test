# Google Tasks MCP Server

> **⚠️ AI-Generated Learning Project**  
> This project was fully generated by AI and is intended for learning purposes only. It demonstrates how to create a Model Context Protocol (MCP) server that integrates with Google Tasks API.

## Overview

This is a Node.js/Express server that provides a Model Context Protocol (MCP) interface for Google Tasks. It allows AI assistants to interact with Google Tasks through a standardized protocol, enabling tasks to be searched, fetched, and created programmatically.

## Features

- 🔐 OAuth 2.0 authentication with Google
- 🔍 Search tasks across all lists or specific lists
- 📋 Fetch detailed task information
- ➕ Create new tasks with title, notes, and due dates
- 🛡️ API key protection for MCP endpoints
- ⏱️ Session management with TTL-based cleanup
- 🌐 CORS support for cross-origin requests

## Prerequisites

- Node.js 18+ 
- Google Cloud Project with Tasks API enabled
- Google OAuth 2.0 credentials

## Setup

### 1. Google Cloud Setup

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project or select existing one
3. Enable the Google Tasks API
4. Create OAuth 2.0 credentials:
   - Go to "APIs & Services" > "Credentials"
   - Click "Create Credentials" > "OAuth 2.0 Client IDs"
   - Set application type to "Web application"
   - Add authorized redirect URIs (e.g., `https://your-domain.com/oauth2/callback`)

### 2. Environment Variables

Create a `.env` file or set environment variables:

```bash
# Google OAuth
GOOGLE_CLIENT_ID=your_client_id_here
GOOGLE_CLIENT_SECRET=your_client_secret_here
GOOGLE_REDIRECT_URI=https://your-domain.com/oauth2/callback

# MCP API Key (generate a secure random string)
MCP_API_KEY=your_secure_api_key_here

# Optional: Force JSON responses for MCP
MCP_FORCE_JSON=1

# Server port
PORT=8080
```

### 3. Install Dependencies

```bash
npm install
```

## Usage

### 1. Start the Server

```bash
npm start
# or
node server.js
```

### 2. Generate OAuth Token

**Important**: The first time you use this server, you need to generate an OAuth token:

1. Visit: `https://your-domain.com/oauth2/start`
2. Complete the Google OAuth flow
3. You'll be redirected back with a success message

### 3. Test the API

#### Basic Tasks Endpoint
```bash
curl -H "X-API-Key: your_api_key" https://your-domain.com/tasks
```

#### MCP Health Check
```bash
curl -H "X-API-Key: your_api_key" https://your-domain.com/mcp/health
```

### 4. Available MCP Tools

The server provides these MCP tools:

- **`search`**: Search tasks by title across all lists or a specific list
- **`fetch`**: Get detailed information for a specific task
- **`create_task`**: Create a new task with title, notes, and optional due date

## Important Notes

### ⚠️ Token Persistence

**This is a learning project with in-memory token storage.** 

- Tokens are stored in memory and **not persisted**
- After any server restart or redeploy, you must regenerate the OAuth token
- Visit `/oauth2/start` again to re-authenticate

### 🔐 Security Considerations

- This is a learning project - **do not use in production** without significant security improvements
- API keys and OAuth tokens are stored in memory
- CORS is configured to allow all origins (should be restricted in production)
- Debug endpoints are exposed (should be removed in production)

## Deployment to Google Cloud Run

### 1. Prepare for Deployment

1. Ensure your `Dockerfile` is present (should be included)
2. Set up environment variables in Google Cloud Run
3. Configure the redirect URI to match your Cloud Run URL

### 2. Deploy to Cloud Run

```bash
# Build and deploy
gcloud run deploy google-tasks-mcp \
  --source . \
  --platform managed \
  --region us-central1 \
  --allow-unauthenticated \
  --set-env-vars "GOOGLE_CLIENT_ID=your_client_id" \
  --set-env-vars "GOOGLE_CLIENT_SECRET=your_client_secret" \
  --set-env-vars "GOOGLE_REDIRECT_URI=https://your-service-url/oauth2/callback" \
  --set-env-vars "MCP_API_KEY=your_api_key"
```

### 3. Update OAuth Redirect URI

After deployment, update your Google OAuth credentials with the new Cloud Run URL:
- Go to Google Cloud Console > APIs & Services > Credentials
- Edit your OAuth 2.0 client
- Add the new redirect URI: `https://your-service-url/oauth2/callback`

### 4. Generate Token After Deploy

After deployment, you must generate a new OAuth token:
1. Visit: `https://your-service-url/oauth2/start`
2. Complete the OAuth flow
3. The server will now be ready to handle MCP requests

## API Endpoints

| Endpoint | Method | Description | Auth Required |
|----------|--------|-------------|---------------|
| `/` | GET | Health check | No |
| `/health` | GET | Server status | No |
| `/oauth2/start` | GET | Start OAuth flow | No |
| `/oauth2/callback` | GET | OAuth callback | No |
| `/tasks` | GET | Get tasks | API Key |
| `/mcp/health` | GET | MCP health check | API Key |
| `/mcp` | POST | MCP protocol endpoint | API Key |
| `/debug/envkeys` | GET | Debug environment | No |
| `/debug/env` | GET | Debug environment | No |

## Development

### Local Development

```bash
# Install dependencies
npm install

# Start development server
npm start

# The server will be available at http://localhost:8080
```

### Environment Variables for Development

Create a `.env` file for local development:

```bash
GOOGLE_CLIENT_ID=your_client_id
GOOGLE_CLIENT_SECRET=your_client_secret
GOOGLE_REDIRECT_URI=http://localhost:8080/oauth2/callback
MCP_API_KEY=your_api_key
PORT=8080
```

## Troubleshooting

### Common Issues

1. **"Not authorized" errors**: Visit `/oauth2/start` to generate a new token
2. **"No access token" errors**: Tokens expire - regenerate via OAuth flow
3. **CORS errors**: Check your CORS configuration and allowed origins
4. **API key errors**: Ensure you're passing the correct API key in headers

### Debug Endpoints

For troubleshooting, these debug endpoints are available:
- `/debug/envkeys` - Check if Google environment variables are set
- `/debug/env` - Verify OAuth configuration

## Project Structure

```
├── server.js          # Main server file
├── package.json       # Dependencies and scripts
├── Dockerfile         # Container configuration
├── README.md          # This file
└── .env.example       # Environment variables template
```

## Contributing

This is an AI-generated learning project. Feel free to experiment and learn from the code, but please note this is not intended for production use without significant modifications.

## License

MIT License - see [LICENSE](LICENSE) file for details.

## Disclaimer

This project was generated by AI for educational purposes. It demonstrates concepts but should not be used in production without proper security review and modifications. The author(s) are not responsible for any misuse of this code.

---

**Happy Learning! 🚀** 